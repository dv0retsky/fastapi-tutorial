|||
|---|---|
|ДИСЦИПЛИНА|Технологии разработки серверных приложений|
|ИНСТИТУТ|ИПТИП|
|КАФЕДРА|Индустриального программирования|
|ВИД УЧЕБНОГО МАТЕРИАЛА|Методические указания к практическим занятиям|
|ПРЕПОДАВАТЕЛЬ|Дворецкий Артур Геннадьевич|
|СЕМЕСТР|4 семестр, 2025/2026 уч. год|

Ссылка на материал: <br>
https://github.com/dv0retsky/fastapi-tutorial/blob/main/FAPI3_Processing%20requests/FAPI3_Processing%20requests.md

---

# Практическое занятие №4: Postman для тестирования API

Основное назначение **Postman** - облегчить разработку, тестирование и документирование **API**. С его помощью можно отправить данные в запросе и проверить полученный ответ. Также у него есть много других интересных возможностей. Можно например сохранять запросы в папки и коллекции, удобно параметризовывать запросы. Запускать коллекции с помощью `Collection Runner` и использовать их как автоматизированные тесты. **Postman** позволяет проектировать дизайн **API** и создавать на его основе **Mock-сервер**.

Тестировщики с помощью **Postman** могут отправлять `HTTP`/`HTTPS` запросы к сервисам и получать ответы от них. С помощью такого подхода можно протестировать бэкенд сервисы и убедиться, что они работают корректно. С помощью **Postman** можно выполнять запросы к различным типам **API**, таким как **REST**, **SOAP** и **GraphQL**.

**Postman** - это сейчас достаточно популярный инструмент, который использует в работе много людей. У него есть большое сообщество, в котором в случае необходимости можно будет найти ответы на появившиеся вопросы.

Для установки под **Windows**:

- Загрузите [последнюю версию **Postman**](https://www.postman.com/downloads/);
- Запустите `.exe` файл для установки;
- После окончания процесса установки потребуется зарегистрироваться. Для простоты можно выбрать вариант регистрации с помощью существующего **google** аккаунта.

Для установки под **Mac** или **Linux** воспользуйтесь этими инструкциями:

- [Установка для Mac](https://learning.postman.com/docs/getting-started/installation/installation-and-updates/#install-postman-on-mac);
- [Установка для Linux](https://learning.postman.com/docs/getting-started/installation/installation-and-updates/#install-postman-on-linux).

Также у **Postman** есть [web версия](https://learning.postman.com/docs/getting-started/installation/installation-and-updates/#use-the-postman-web-app), которая работает прямо в браузере. Она доступна по этой [ссылке](https://web.postman.co/home). На данный момент эта версия находится в процессе доработок, поэтому часть возможностей настольной версии там недоступна.

Попробуйте установить себе подходящую версию **Postman**, чтобы в дальнейшем была возможность практиковать полученные знания.

Сейчас мы кратко рассмотрим основные элементы **Postman**, необходимые для начала работы. Но для этого нам потребуется создать новое рабочее пространство (`Workspace`). В верхнем меню выбираем соответствующий пункт и нажимаем кнопку `Create Workspace`.

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig5.png" />
</div>

В открывшемся окне вводим название нашего рабочего пространства. Пусть это будет **Postman for beginners**. В поле `Summary` можем добавить краткое описание. Затем можно указать уровень доступа. Т.к. я не планирую совместное использование своих запросов с кем-то еще, выбираю настройку `Personal`. Это значит, что созданный `workspace` будет доступен только мне. В конце нажимаем кнопку `Create Workspace`.

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig6.png" />
</div>

Теперь рабочее пространство создано и можем двигаться дальше. Перед нами окно приложения. Оно состоит из:

- верхнего меню;
- нижнего меню;
- бокового меню;
- основной зоны работы.

Верхнее меню дает возможность создания рабочего пространства (`Workspaces`) и доступа к различным **api (API Network)**. Также с его помощью можно делать поиск. `Home` - содержит вашу домашнюю страницу. На ней можно посмотреть вашу недавнюю активность. С помощью `Workspaces` - можно создать новое рабочее пространство, выбрать одно из недавно посещенных, либо сделать поиск по существующим.

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig7.png" />
</div>

В боковом меню доступны основные функциональные элементы Postman. В истории (`History`) вы можете увидеть сделанные ранее запросы. Для более удобного хранения, группировки и поиска таких запросов в Postman есть коллекции (`Collections`). К остальным элементам бокового меню мы вернемся позже. Если у вас небольшой экран, для удобной работы можно свернуть боковое меню с помощью кнопки в нижнем левом углу.

Большая часть вашей работы в **Postman** будет проходить в основной рабочей зоне. Основные её части - вкладки, выпадающий список для выбора окружения и правое боковое меню. К двум последним мы вернемся позже. Вкладки нам нужны, для лучшей организации работы с запросами. Здесь **Postman** сделан по тому же принципу, что и браузеры, где новую страницу удобнее открывать в новой вкладке.

Далее мы рассмотрим другие элементы основной рабочей зоны и отправим первый запрос с помощью **Postman**.

**Основная функциональность Postman** — возможность создания и отправки запросов к API для проверки его функциональности и получения данных. Для этого не потребуется писать код или команды в терминале. В интерфейсе Postman вы создаете запрос, нажимаете кнопку «Отправить» и получаете ответ от **API**. **API расшифровывается как Application Programming Interface** или программный интерфейс приложения. С его помощью мы можем получить доступ к возможностям другого приложения и обмениваться с ним данными. Такое приложение называется **API-сервером**. Отправка запросов и получение ответов происходит через интернет с помощью протокола **HTTP**. Приложение, которое отправляет запрос, называется клиентом. Это может быть мобильное приложение, web-сайт или другой сервис.

Запрос всегда содержит **URL** вызываемого эндпоинта **API** и **HTTP** метод запроса. Эндпоинт — это **URL**, который предоставляет доступ к определенной функциональности сервиса. Он позволяет клиентским приложениям отправлять запросы на сервер и получить доступ к данным или выполнить определенные операции. Каждый эндпоинт обычно связан с определенным **HTTP-методом**, таким как, например, `GET` или `POST`, который определяет тип операции, которую можно выполнить с помощью этого эндпоинта. Наиболее часто используются следующие методы:

- `POST` - для добавления новых данных
- `GET` - для чтения данных
- `PUT` - для обновления данных
- `PATCH` - для частичного обновления данных
- `DELETE` - для удаления данных

Давайте попробуем отправить первый запрос. Это будет `POST` запрос из демонстрационного **API Swagger Petstore**. Подробнее с ним вы сможете познакомиться по [ссылке](https://petstore.swagger.io). Выглядит запрос следующим образом:

```bash
https://petstore.swagger.io/pet
```

Для отправки в Postman выбираем метод `POST`. Копируем адрес нашего эндпоинта и нажимаем кнопку `Send`. В результате получаем ответ, содержащий данные в виде **json** объекта.

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig1.png" />
</div>

Здесь мы можем увидеть тело ответа (**Body**), который мы получили от сервера. Postman автоматически распознает формат **JSON** и форматирует его для лучшего восприятия. Помимо **Body**, мы можем посмотреть куки (**Cookies**) и заголовки (**Headers**) ответа, нажав на соответствующие ссылки. Также мы видим, что наш запрос выполнился успешно и в ответе мы получили код ответа `200 OK`. На выполнение запроса ушло 700 мс. Содержимое в теле ответа, время обработки и размер могут отличаться от примера выше, т.к. на сервисе добавляются новые записи и удаляются старые.

Многие учащиеся копируют адрес запроса и вставляют в **Postman**. Если вы делаете так же, обратите внимание, чтобы адрес скопировался без посторонних символов. Часто вместе с адресом копируются пробелы или переносы строк. В этом случае в результате выполнения запроса, вы получите ответ `404 Not Found`.

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig2.png" />
</div>

### Задание:

1.	Написать тесты в **Postman** по `https://petstore.swagger.io/`

2.	Реализовать 3 основные папки (`Pet`, `Store`, `User`). См. Рисунок ниже.

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig3.png" />
</div>

3.	Прописать эндпоинты.

4.	Сделать автотестирование, используя «`Run collection`».

---

## Работа с запросами и ответами в Postman

Запрос может содержать различную информацию, которая определяет, какие данные **Postman** отправит при взаимодействии с **API**. Обязательно нужно указать метод запроса и его **URL**. С их помощью определяется **API эндпоинт**, который предоставляет доступ к определенной функциональности сервиса, с которой **Postman** будет взаимодействовать.

Для начала давайте попробуем отправить основные типы `HTTP запросов`.

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig8.png" />
</div>

Создадим новый запрос. Для этого в верхнем меню нужно выбрать `File` > `New`...

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig9.png" />
</div>

В появившемся окне в разделе `Building Blocks` выбираем `HTTP Request`. Либо можно рядом с существующими вкладками запросов нажать `+` и создать новую вкладку.

### GET запрос.

Попробуем отправить **GET запрос**. `GET` - это один из основных методов **HTTP протокола**. Обычно такой тип запросов используется для чтения данных. В `GET` запросе клиент запрашивает определенный ресурс, который находится на сервере, и получает ответ от сервера в виде содержимого ресурса.

```bash
https://petstore.swagger.io/v2/store/inventory
```

Метод `GET` у нас уже выбран по умолчанию. Осталось указать **URL** нашего **API**. После того, как мы начнем вводить его, Postman в выпадающем списке покажет нам ранее введенные адреса. В данном примере наш **URL** состоит из двух частей. 

Первая из них **базовый (base) URL** - это `https://petstore.swagger.io`. Она состоит из протокола **https**. Здесь чаще всего будет использоваться либо **https**, либо **http** протокол. Затем идёт **host**, представленный доменным именем `petstore.swagger.io`. Вместо него также может быть использован **ip адрес хоста**. И затем идет неявно указанный порт, в нашем случае это `443`. Указанный неявно - означает, что если вы добавите к запросу порт: `https://petstore.swagger.io:443`, ничего не изменится, т.к. этот же порт используется по умолчанию для протокола **https**. Если же ваш запрос использует протокол **http**, порт по умолчанию будет `80`. Если порт отличается от используемых по умолчанию, потребуется явно указать его через двоеточие. 

Вторая часть это путь(`path`) запроса. Он находится сразу после `base URL`.

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig10.png" />
</div>

После ввода **URL** мы можем отправить запрос. Для этого нужно нажать кнопку `Send`. Через некоторое время после этого в нижней части главного окна мы увидим ответ от сервера. Его содержимое мы рассмотрим позже, а пока давайте перейдем к другим запросам.

Иногда в запросе может потребоваться отправить больший объем данных, чем пара ключ и значение, как это было в прошлых примерах. Например, вы хотите добавить нового пользователя. Будет не очень удобно передавать информацию о нем в виде `path` или `query` параметров. Для таких случаев используется передача параметров в теле запроса. Обычно такой способ применяется с `POST`, `PUT` и `PATCH` запросами. Информация о пользователе будет передана в теле запроса в виде `XML` или `JSON`.

**XML (Extensible Markup Language)** — это язык разметки, который используется для представления и передачи данных. Он был разработан для того, чтобы облегчить обмен данными между различными системами. **XML** представляет собой текстовый формат, который содержит теги, атрибуты и значения. Теги используются для определения элементов данных, а атрибуты позволяют указывать дополнительные характеристики для этих элементов. Значения могут быть текстовыми или другими элементами данных.

```xml
<person>
	<name>Artur</name>
	<lastname>Dvoretsky</lastname>
	<age>26</age>
	<address>
		<street>Lenina str.</street>
		<city>Moscow</city>
	</address>
</person>
```

Этот объект в формате XML представляет человека с именем Artur, фамилией Dvoretsky, возрастом 26 лет, живущего в Москве, на улице Ленина.

**JSON (JavaScript Object Notation)** — это легковесный формат для передачи данных, основанный на синтаксисе объектов **JavaScript**. Он используется для обмена данными между клиентом и сервером в интернет-приложениях. **JSON** представляет данные в виде пар имени и значения, где имя — это строка, а значение может быть строкой, числом, логическим значением, массивом, объектом или `null`.

```json
{
  "name": "Artur",
  "lastname": "Dvoretsky",
  "age": 26,
  "address": {
    "street": "Lenina str.",
    "city": "Moscow"
  }
}
```

Этот объект в формате **JSON** аналогичен предыдущему. Также представляет человека с именем Artur, фамилией Dvoretsky, возрастом 26 лет, живущего в Москве, на улице Ленина.

Давайте рассмотрим основные отличия `JSON` и `XML`:

- Обычно данные в формате `JSON` имеют меньший размер, чем `XML-данные`, благодаря своему более компактному синтаксису.
- `JSON` использует более простой и компактный синтаксис, чем `XML`.
- `XML-файлы` обычно более читабельны, чем `JSON-файлы`, потому что `XML` использует явные теги и атрибуты, которые часто легче понимать, чем названия полей в `JSON`.
- `XML` позволяет более глубокую вложенность, чем `JSON`, что может быть полезно для некоторых типов данных.

В целом, `JSON` и `XML` имеют свои преимущества и недостатки, и выбор того, какой формат использовать, зависит от конкретных потребностей приложения.

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig11.png" />
</div>

Давайте вернемся в **Postman** и откроем вкладку `body`. На ней вы можете задать нужные данные, которые будут отправлены вместе с запросом. Там же можно выбрать тип отправляемых данных. В предыдущих запросах по умолчанию **Postman** для тела запроса использовал тип `none`.

Тип данных в теле запроса определяется из заголовка. Заголовки **HTTP (HTTP headers)** — это часть **HTTP-запроса** и ответа, которая передается между клиентом и сервером. Они содержат метаданные, необходимые для правильной обработки запроса и ответа. С помощью заголовков **HTTP** можно указать, например, тип передаваемого содержимого. Заголовок `content-type` в **HTTP** необходим для указания типа содержимого (например, текст, изображение, аудио или видео), передаваемого в теле запроса или ответа. Это позволяет получателю запроса или ответа правильно интерпретировать содержимое и выбрать соответствующий способ его обработки. Если этот заголовок отсутствует или указан неверно, это может привести к неправильной обработке содержимого или даже к ошибкам при его отображении. Поэтому правильное использование заголовка `content-type` очень важно для правильной обработки запросов и ответов в протоколе **HTTP**.

Если вы планируете отправлять данные в теле запроса, необходимо убедиться, что добавлен правильный заголовок `content-type`. Он нужен для того, чтобы **API** мог корректно обработать полученный запрос. Для типов `form-data` и `x-www-form-urlencoded` **Postman** автоматически добавит в заголовки нужный `content-type`. Если вы планируете использовать тип `raw`, **Postman** добавит заголовок на основе выбранного вами типа (например, `json` или `text`). Для типа `binary` **Postman** не будет добавлять никаких заголовков. Заданный вручную заголовок `content-type` переопределяет значение, указанное **Postman**.

- `form-data` — этот формат в **HTTP** используется для передачи данных, которые представляют собой набор пар **«ключ-значение»**. Такой тип часто используется при отправке данных формы на сайтах. Каждая пара соответствует одному элементу формы, например, текстовому полю, флажку и т.д. Еще с помощью формата `form-data` можно передавать файлы.
- Формат `x-www-form-urlencoded` внешне очень похож на `form-data`. Здесь данные также передаются в формате **ключ-значение**. Основное отличие от `form-data`: здесь мы не можем передавать файлы и указывать тип данных для каждого из полей.
- `Binary` — это формат, который предназначен для отправки бинарных данных. Он используется для передачи бинарных данных, таких как изображения, аудио, видео и другие файлы.
- `raw` — предназначен для отправки текстовых данных в различных форматах, таких как: `Text`, `JavaScript`, `JSON`, `HTML` и `XML`. 
- `GraphQL` — позволяет отправлять запросы на языке запросов `GraphQL`. В рамках этого курса этот тип запросов не будет рассматриваться, но если вам интересно, можете ознакомиться с ним самостоятельно на [официальной странице GraphQL](https://graphql.org).

## Работа с ответами

До сих пор мы рассматривали запросы к **API**. Теперь давайте подробнее остановимся на том, что нам приходит в ответе от сервера. **Postman** поможет нам с просмотром ответов. В нем есть возможность визуализации тела ответа, а также проверки его корректности. Основные части ответа — это код ответа, заголовки и тело ответа. Рассмотрим их более детально.

```bash
https://postman-echo.com/post?name=anna
```

Воспользуемся одним из предыдущих запросов. Укажем тип и **url** запроса, нажмем кнопку `Send`. Через некоторое время после этого в нижней части главного окна мы увидим ответ от сервера. Его содержимое мы будем рассматривать далее.

В **Postman** тело ответа мы можем посмотреть в нижней части главного экрана, на вкладке `body`. Она предоставляет несколько инструментов, которые помогут эффективнее работать с ответами от **API**. Это 4 вида представления тела ответа: `Pretty`, `Raw`, `Preview` и `Visualize`. В первых двух доступна функция поиска в запросе. Для открытия окна поиска нужно будет выбрать иконку поиска или нажать сочетание клавиш `⌘+F` или `Ctrl+F`. В **Postman** доступен автоматический показ изображений в теле ответа, если он содержит соответствующий заголовок `content-type`.

Форматированный (`Pretty`) вид — представление тела запроса для форматов **JSON** и **XML**. Этот вид автоматически форматирует полученный ответ для более легкого восприятия. Применяется удобная подсветка различных частей текста.

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig12.png" />
</div>

**Postman** делает форматирование автоматически, на основе пришедшего заголовка `content-type`. Для принудительного изменения форматирования можно воспользоваться выпадающим списком для выбора иного формата, рядом с кнопкой `Visualize`.

Если вы работаете только с форматом **JSON**, можно выставить принудительное форматирование в этом формате. Для этого в верхнем меню нужно выбрать раздел настроек (`Settings`). На вкладке `General` найти настройку определения языка (`Language detection`). Затем поменять ее значение с `Auto` на `JSON`.

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig13.png" />
</div>

Неформатированный (`Raw`) вид - текстовое представление тела ответа, без дополнительного форматирования. Позволяет просмотреть его в полученном виде.

Предпросмотр (`Preview`) - этот вид позволяет удобно просматривать полученное содержимое в обработанном виде. Это может быть удобно например в случае получения стандартных ошибок, которые приходят в виде `HTML` страницы.

Для бинарных типов данных в ответах, таких как аудио файлы, `pdf` документы, `zip` архивы или что-то другое вы можете воспользоваться кнопкой `Send` and `download`, чтобы сохранить ответ и проверить его локально на своем компьютере.

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig14.png" />
</div>

Визуализация (`Visualize`) - позволяет обработать полученный ответ собственным способом. Код для визуализации добавляется отдельно.

## Коллекции и переменные

В **Postman** вы можете группировать запросы и примеры ответов в коллекции. Это поможет вам удобнее организовать свое рабочее пространство, создавать тестовую документацию и тесты для **API**. Для открытия коллекций вам нужно нажать на вкладку `Collections`, расположенную в боковом меню.

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig15.png" />
</div>

### Создание коллекции

Для создания новой коллекции вам нужно перейти на вкладку `Collections` и нажать `+`. Далее нужно выбрать `Blank collection` и указать имя коллекции, в нашем случае это будет `Lesson_4`.

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig16.png" />
</div>

Также можно создать коллекцию через верхнее меню. Для этого нужно выбрать `New` > `Collection`. Чтобы изменить название коллекции, нажмите на название коллекции и укажите новое имя. Для добавления описания к коллекции нажмите на `View complete documentation` в нижней части вкладки `Overview`. Откроется новая вкладка, где вы сможете добавить текст описания.

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig17.png" />
</div>

В настройках коллекции:

- На вкладке **Overview** находится описание текущей коллекции. 
- Вкладка **Authorization** позволяет настроить авторизацию для запросов этой коллекции.
- На вкладке **Scripts** настраиваются скрипты, запускаемые перед отправкой запросов из этой коллекции на сервер. Ещё она содержит тестовые скрипты для данной коллекции, которые запускаются после получения ответов от **API**.
- На вкладке **Variables** вы сможете определить значения переменных, используемых внутри этой коллекции.
- Вкладка **Runs** содержит тестовые прогоны данной коллекции.

**Переменные в Postman** позволяют сохранить и повторно использовать различные значения. После создания переменной, её значение можно использовать в коллекциях, окружениях, запросах или тестовых скриптах, ссылаясь с помощью имени этой переменной.

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig18.png" />
</div>

Попробуем добавить новую переменную. Откроем один из ранее использованных запросов. Выделим значение `path` параметра `id`. **Postman** подсказывает, что можно добавить переменную, содержащую это значение. Для этого нужно выбрать `Set as variable`. Далее выбираем `+ Set as new variable`.

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig19.png" />
</div>

В новом окне нужно будет указать имя переменной и её область видимости. Имя нашей переменной будет `pet_id`. Значение уже указано, в данном способе добавления переменной его изменить не получится. Про область видимости подробнее мы поговорим, а пока укажем `Global` и нажмём кнопку `Set Variable`.

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig20.png" />
</div>

Теперь вместо значения параметра `id` мы видим переменную `pet_id` в двойных фигурных скобках. Если навести на имя переменной, появится всплывающая подсказка. В ней можно увидеть имя переменной, ее значения и область видимости. Нажав на кнопку `Send`, вы можете убедиться, что запрос работает так же, как и прежде.

**Переменные в Postman** — это пары ключ-значение. Имя переменной является ключом, по которому мы к ней обращаемся для получения доступа к ее значению. Также с помощью переменных можно передавать значения между запросами и тестами.

Таким образом, в переменной мы можем хранить какие-либо данные. Для доступа к ним используется имя переменной. Добавление переменных бывает полезно, когда нужно использовать одинаковые данные в нескольких местах. Они сделают ваши запросы более читабельными и гибкими, поскольку теперь вы можете задавать нужные данные в одном месте.

В переменных можно хранить не только параметры, но и, например, часть **URL**. Например, в разных запросах может быть одинаковая или повторяющаяся часть адреса. Также может быть часть адреса, которая изменится в будущем. Ее удобно вынести в переменную, чтобы затем производить изменения только в одном месте. 

При использовании нескольких тестовых окружений удобно выносить в переменные базовую часть **url**, поскольку она будет отличаться. Удобно будет задавать значение переменной отдельно для каждого из окружений. Далее в этом разделе мы рассмотрим различные области видимости и типы переменных.

В **Postman** окружение представляет собой набор переменных. Вы можете использовать их для группировки значений и управления доступа к ним, если используете **Postman** всей командой. Использование окружения может быть полезно, если вы используете несколько тестовых стендов. **URL** запросов в этом случае будут отличаться. Их удобно будет хранить в переменных окружения. При переключении окружения будет меняться тестовый стенд и адрес, по которому будут отправляться запросы. Также может быть удобно использовать отдельное окружение для различных пользователей приложения. В этом случае в переменных окружения задаются данные авторизации, при переключении окружения будут меняться пользователи, с данными которых выполняются запросы.

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig21.png" />
</div>

Для просмотра всех окружений выберите вкладку `Environments` в левом боковом меню. Чтобы создать новое окружение на вкладке `Environments`, нажмите на `+` в верхней части списка окружений. Затем введите имя окружения. В примере выше мы создали новое окружение с именем `New Environment`. Если будете добавлять переменные окружения, не забудьте нажать кнопку `Save`.

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig22.png" />
</div>

Окружение, используемое в данный момент, называется активным. Оно отображается в правом верхнем углу, рядом с иконкой `Variables`. Там же вы можете поменять его, выбрав нужное окружение в выпадающем списке. 

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig23.png" />
</div>

Активное окружение также можно выбрать в разделе окружений, на вкладке `Environments`. Для этого нужно нажать на иконку `'Set active'` справа от имени нужного окружения. Там же можно сделать окружение неактивным, нажав на `'Set inactive'`. Чтобы открыть окружение в редакторе, нажмите на его имя в списке. Далее мы рассмотрим работу с переменными окружения.

### Переменные окружения

Переменные окружения позволяют организовать область видимости для работы с различными окружениями. Например, у вас может быть стенд для разработки и отдельный тестовый стенд. В разные моменты времени каждый из них будет активным. Если у вас только одно окружение, эффективнее будет использовать переменные коллекций.

Чтобы посмотреть переменные окружения, в левом боковом меню выберите вкладку `Environments`. Затем кликните на имя нужного окружения. 

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig24.png" />
</div>

Для создания переменной окружения, после выбора окружения введите имя переменной в столбце `Variable`. Задайте начальное значение в столбце `Initial value`, текущее значение в столбце `Current value`. Укажите тип переменной и нажмите кнопку `Save`. Редактирование значений делается аналогично другим типам переменных.

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig25.png" />
</div>

Для остальных операций с окружением, нужно нажать на иконку `View more actions`, справа от имени окружения. Здесь можно удалить или переименовать окружение. Создать его копию, переместить его, а также дать доступ другим членам команды.

## Скрипты для автоматизации тестирования 

### Отладка запросов к API с помощью консоли Postman

После отправки запроса к **API** результат может не соответствовать ожиданиям. Это может быть вызвано разными причинами. Чтобы выяснить, в чём проблема, и устранить неполадки в вашем запросе, можно использовать консоль **Postman**. Далее мы рассмотрим, как это можно сделать.

Откройте консоль, выбрав значок `«Console»` в нижнем левом углу **Postman**. В настольном приложении **Postman** вы можете использовать `Cmd + Option + C` или `Ctrl + Alt + C`, чтобы открыть консоль Postman в новом окне.

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig26.png" />
</div>

Каждый отправленный запрос регистрируется в консоли **Postman**. Это позволяет вам просмотреть подробную информацию о том, что произошло во время отправки запроса. Вы можете использовать консоль для отладки ваших запросов, особенно если **API** работает не так, как вы ожидали. Открытая во время отправки запроса консоль сделает ваши запросы более наглядными благодаря логированию сообщений при отладке.

Например, при отправке одного из ранее использованных запросов вы можете увидеть в консоли всю необходимую информацию о том, как проходил запрос:

```bash
https://petstore.swagger.io/v2/store/inventory
```

Для этого нужно открыть консоль. Там будут видны все данные, относящиеся к запросу:

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig27.png" />
</div>

Консоль **Postman** регистрирует следующую информацию:

- Отправленный запрос.
- Заголовки запроса, значения переменных и редиректы.
- Конфигурация прокси-сервера.
- Сертификаты, используемые для запроса.
- Сетевая информация, такая как IP-адреса, шифры и используемые протоколы.
- Логирование операторов и асинхронных запросов из `pre-request` и `post-response` скриптов.
- Ответ в необработанной форме.

Если **Postman** не может отправить ваш запрос или не получает ответа от **API**, которому был отправлен запрос, вы увидите сообщение об ошибке. В этом сообщении будет содержаться информация о возникшей проблеме и ссылка на консоль. В консоли вы сможете найти подробную информацию о вашем запросе.

```bash
https://postman-echo1.com/get
```

В этом запросе намеренно допущена неточность, чтобы в результате мы получили ошибку.

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig28.png" />
</div>

Выберите `«View in Console»`, чтобы просмотреть сведения о запросе в консоли и узнать больше о том, что пошло не так.

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig29.png" />
</div>

### Навигация по консоли

Консоль **Postman** отображает сетевую информацию, заголовки и тело запроса и ответа для каждого запроса, а также любые залогированные сообщения консоли, поступающие из ваших сценариев.

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig30.png" />
</div>

Фильтрация по типу сообщений журнала в разделе `'All logs'`. Здесь можно выбрать отображение только нужных уровней логирования. По умолчанию выбраны все четыре уровня: `Log`, `Info`, `Warning` и `Error`.

Выберите значок с тремя точками, чтобы включить или отключить временные метки и отображение сетевой информации.

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig31.png" />
</div>

По умолчанию консоль будет регистрировать последние `5000` сообщений за `24` часа. Выберите `Clear`, чтобы очистить список.

Как мы уже говорили, скрипты, которые запускаются перед отправкой запроса, можно добавить на вкладке `«Scripts» -> «Pre-request»` на уровне коллекции, папки или самого запроса. Обычно эти скрипты используются для предварительной обработки запроса перед тем, как он будет отправлен на сервер. 

С их помощью можно устанавливать значения переменных, параметров, заголовков или тела запроса. Также можно выводить в консоль дополнительную информацию для отладки скриптов.

Например, представьте, что у вас есть определённый запрос. Прежде чем его выполнить, вы хотите увидеть дополнительную информацию, например, значение переменной, которую вы затем используете в этом запросе. Давайте попробуем написать скрипт, который будет реализовывать такую логику.

1. Создадим новую коллекцию. Назовем ее `«Lesson_4_3»`.
2. Добавим переменную уровня коллекции с именем `«petId»` и значением `1`.

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig32.png" />
</div>

3. Добавим в коллекцию один из ранее использованных `POST` запросов:

```bash
https://petstore.swagger.io/v2/pet
```

4. Добавим тело запроса:

```json
{
    "id": {{petId}},
    "category": {
        "id": {{$randomInt}},
        "name": "dog"
    },
    "name": "{{$randomFirstName}}",
    "status": "available"
}
```

5. Давайте откроем вкладку `«Scripts»` и выберем пункт `«Pre-request»`. Затем добавим туда код, который поможет нам получить значение переменной коллекции `petId`. После этого мы сможем вывести это значение в консоль с помощью метода `log.console()`. Чтобы получить значение переменной, мы можем воспользоваться уже готовым кодом, который называется сниппет. Для этого в правой части вкладки найдём пункт `«Get a collection variable»`. После этого в окне скрипта появится готовый код для получения переменной коллекции.

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig33.png" />
</div>

Этот сниппет возвращает значение переменной с именем `«variable_key»` из текущей коллекции. 

6. Давайте немного изменим этот код, чтобы он возвращал значение переменной и выводил его в консоль. Назовём эту переменную `«petId»` и воспользуемся функцией `console.log()` для вывода значения. После этого код на вкладке `«Scripts» -> «Pre-request»` должен выглядеть так:

```js
console.log(pm.collectionVariables.get("petId"));
```

7. Откроем **Postman** `console` и нажмём кнопку `clear`. Запустим наш запрос и посмотрим на информацию в консоли **Postman**.

<div align="center">
  <img alt="Project Demo" src="./FAPI4_Fig34.png" />
</div>

В первой строке отображается значение переменной `petId`, которое мы задали при создании. Затем следует сам **POST-запрос**. Нажав на треугольник слева от запроса, вы увидите данные запроса и ответа, а также дополнительную информацию.

Чтобы скрипт запускался перед каждым запросом в коллекции, его можно добавить на вкладке `«Scripts» -> «Pre-request»` нужной коллекции. То же самое можно сделать для папок, находящихся внутри коллекции.

